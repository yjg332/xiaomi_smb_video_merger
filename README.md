# 小米摄像头SMB协议视频合并工具

这个工具用于通过SMB协议读取指定网络路径下的MP4文件，并按照文件夹日期时间顺序合并这些文件。程序会连接到SMB服务器，遍历每个日期时间文件夹（如2025031205），将其中的MP4文件按名称排序后合并成一个文件，并将合并后的文件保存在原文件夹中。

## 功能特点

- 自动连接SMB服务器并浏览文件夹
- 按照文件名顺序合并MP4文件
- 将合并后的文件上传回原文件夹
- 自动清理临时文件
- 清理原始文件

## 运行方式

### 方式一：使用自动安装脚本（推荐）

该脚本将：

1. 自动安装所需的Python库
2. 如果系统中没有安装ffmpeg，会自动下载并使用内置的ffmpeg
3. 运行视频合并程序

### 方式二：手动安装依赖

如果您希望手动安装依赖，请确保已安装以下内容：

```
pip install pysmb
pip install ffmpeg-python
```

此外，您可以选择以下任一方式提供ffmpeg：

1. 将ffmpeg.zip文件放在脚本同一目录下（程序会自动解压并使用）
2. 从[FFmpeg官网](https://ffmpeg.org/download.html)下载FFmpeg并安装到系统中
   - 解压到任意文件夹
   - 将FFmpeg的bin目录添加到系统PATH环境变量中

## 使用方法

1. 打开`smb_video_merger.py`文件，根据需要修改以下配置：
如windows下：
\\10.10.10.2\xiaomisxt\xiaomi_camera_videos\607EA4901FA8
```python
# SMB连接信息
SMB_SERVER = '10.10.10.2'  # SMB服务器IP地址
SMB_SHARE = 'xiaomisxt'    # 共享名称
SMB_PATH = 'xiaomi_camera_videos/607EA4901FA8'  # 共享内的路径
SMB_USERNAME = ''  # 用户名
SMB_PASSWORD = ''  # 密码
```

2. 运行脚本：

- 可青龙运行
- 可本地运行

## 工作流程

1. 连接到指定的SMB服务器
2. 列出指定路径下所有符合日期时间格式的文件夹（如2025031205）
3. 对于每个文件夹：
   - 列出所有MP4文件并按名称排序
   - 下载所有MP4文件到本地临时目录
   - 使用FFmpeg合并视频文件
   - 将合并后的文件上传回原文件夹
   - 清理临时文件
   - 清理原始文件
## 注意事项

- 确保有足够的磁盘空间用于临时文件存储
- 合并大型视频文件可能需要较长时间
- 请确保网络连接稳定，以避免文件传输中断
